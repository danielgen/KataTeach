<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<title>Go Position Labeler</title>
<script src='web/wgo.min.js'></script>
<style>
  body { margin: 20px; font-family: Arial, sans-serif; }
  .container { display: flex; gap: 20px; max-width: 100%; }
  .board-section { flex: 0 0 520px; }
  .controls-section { flex: 1; min-width: 500px; }
  .labels-container { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 15px; 
    margin-bottom: 20px;
    max-width: 800px;
  }
  .label-column { 
    background: #f8f9fa; 
    padding: 6px; 
    border-radius: 6px; 
    border: 1px solid #dee2e6;
    max-width: 380px;
  }
  .label-group { 
    margin: 14px 0 10px; 
  }
  .label-group h4 { 
    margin: 8px 0 8px; 
    color: #495057; 
    font-size: 12px; 
    font-weight: bold; 
    text-transform: uppercase; 
    border-bottom: 2px solid #007bff; 
    padding-bottom: 0;
  }
  .label-column .label-group:first-child h4 {
    margin-top: 12px;
  }
  .tag-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    row-gap: 5px;
    column-gap: 6px;
    align-items: start;
  }
  .tag-block { 
    display: flex;
    align-items: center;
    gap: 6px;
    margin: 0;
    font-size: 16px;
  }
  .tag-block label { 
    display: flex; 
    align-items: center; 
    padding: 0;
    margin: 0;
    line-height: 1.05;
    height: 16px;
    min-height: 16px;
  }
  .tag-block input { 
    margin-right: 4px; 
    flex-shrink: 0;
    transform: scale(0.85);
    vertical-align: middle;
  }
  .tag-block .tag-points {
    display: inline-block;
    line-height: 1;
    font-size: 11px;
    color: #666;
    margin-left: 4px;
  }
  .tag-block .tag-points:empty {
    display: none;
  }
  .labels-container .tag-block { 
    margin: 0 !important; 
  }
  #board { width: 480px; height: 480px; }
  .game-info { 
    background: #f9f9f9; 
    padding: 8px; 
    border-radius: 5px; 
    margin-bottom: 10px;
    font-size: 14px;
    border: 1px solid #ddd;
  }
  .player-names { 
    display: flex; 
    justify-content: space-between; 
    margin-bottom: 5px;
  }
  .player-black { font-weight: bold; }
  .player-white { font-weight: bold; }
  .navigation { 
    margin: 10px 0; 
    text-align: center;
    padding: 10px;
    background: #f5f5f5;
    border-radius: 5px;
  }
  .nav-button { 
    padding: 8px 16px; 
    margin: 0 5px; 
    background: #007bff; 
    color: white; 
    border: none; 
    border-radius: 3px; 
    cursor: pointer;
  }
  .nav-button:hover { background: #0056b3; }
  .move-counter { 
    display: inline-block; 
    margin: 0 10px; 
    font-weight: bold; 
    font-size: 16px;
  }
  .tag-block { margin: 5px 0; }
  .policy-info { 
    background: #f5f5f5; 
    padding: 10px; 
    border-radius: 5px; 
    margin: 10px 0;
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #ddd;
  }
  .policy-move { 
    margin: 2px 0; 
    padding: 4px 8px; 
    background: white; 
    border-radius: 3px;
    font-size: 12px;
    border-left: 3px solid #007bff;
  }
  .policy-move:has(★) {
    background: #fff3cd;
    border-left-color: #ffc107;
    font-weight: bold;
  }
  h3 { margin-top: 20px; margin-bottom: 10px; }
  h4 { margin: 10px 0 5px 0; color: #333; }
  
  /* Hide WGo.js default controls that appear at bottom */
  .wgo-player-wrapper .wgo-player-control { display: none !important; }
  .wgo-player-wrapper .wgo-comments { display: none !important; }
  .wgo-player-wrapper .wgo-info { display: none !important; }
  .wgo-player-wrapper .wgo-infobox { display: none !important; }
  
  /* Hide WGo.js player name boxes that push the board down */
  .wgo-player__box.wgo-player__player-tag { display: none !important; }
  .wgo-player__player-tag { display: none !important; }
  
  /* Style our custom board container */
  #board { 
    border: 2px solid #333; 
    border-radius: 5px; 
    overflow: hidden;
    box-sizing: border-box;
  }
  
  /* Ensure board container doesn't overflow */
  .board-section {
    overflow: hidden;
  }
  
  /* Style only policy move labels to be red - more targeted approach */
  .policy-label {
    fill: red !important;
    color: red !important;
    font-weight: bold !important;
    font-size: 1px !important;
  }
</style>
</head>
<body>
<div class='container'>
  <div class='board-section'>
    <div class='game-info'>
      <div class='player-names'>
        <span class='player-black'>⚫ <span id='black-player'></span></span>
        <span class='player-white'>⚪ <span id='white-player'></span></span>
      </div>
      <div>Game: <span id='game-info'>Loading...</span></div>
    </div>
    <div id='board'></div>
    <div class='navigation'>
      <button id='prev' class='nav-button'>← Prev</button>
      <span class='move-counter'>Move <span id='move_idx'>0</span></span>
      <button id='next' class='nav-button'>Next →</button>
    </div>
    <div class='policy-info'>
      <h4>AI Suggestions</h4>
      <div id='policy_suggestions'></div>
    </div>
  </div>
  <div class='controls-section'>
    <div class='labels-container'>
      <div class='label-column' id='global_column'></div>
      <div class='label-column' id='spatial_column'></div>
    </div>
    <button id='export'>Export Labels</button>
  </div>
</div>
<script>
const SGF = "(;FF[4]CA[UTF-8]DT[2025-09-18]GM[1]GN[1-visit-game-1]KM[7.5]PB[KataGo-1visit]\nPW[KataGo-1visit]RU[Tromp-Taylor]SZ[19];B[dp];W[dd];B[pp];W[pd];B[cf];W[qq];\nB[qp];W[pq];B[op];W[nr];B[nc];W[ce];B[df];W[fd];B[qf];W[nd];B[md];W[ne];B[pc];\nW[qc];B[oc];W[pf];B[dj];W[qg];B[od];W[oe];B[qd];W[pe];B[qb];W[rc];B[rb];W[rd];\nB[hc];W[hd];B[id];W[he];B[ic];W[cq];B[cp];W[dq];B[ep];W[fr];B[fb];W[db];B[ec];\nW[ed];B[cc];W[dc];B[be];W[bf];B[bg];W[bd];B[af];W[kd];B[ld];W[kf];B[kc];W[pl];\nB[qh];W[rg];B[nq];W[mr];B[ql];W[qk];B[pk];W[qm];B[rl];W[rm];B[rq];W[ok];B[or];\nW[gq];B[pj];W[oj];B[pm];W[ol];B[rk];W[qj];B[rj];W[pi];B[pn];W[ri];B[qn];W[dl];\nB[bq];W[br];B[bo];W[aq];B[gp];W[hp];B[ho];W[fp];B[go];W[fo];B[eq];W[fq];B[em];\nW[el];B[fm];W[dm];B[en];W[fl];B[gl];W[gk];B[hm];W[ip];B[hk];W[gj];B[kq];W[mq];\nB[ko];W[oq];B[er];W[bp];B[cn];W[dr];B[es];W[ir];B[np];W[pr];B[kr];W[kp];B[lp];\nW[jp];B[lq];W[il];B[jn];W[hr];B[rr];W[hl];B[gm];W[ls];B[lr];W[ks];B[js];W[ms];\nB[os];W[jr];B[mp];W[is];B[hj];W[hi];B[jk];W[jl];B[ii];W[kk];B[gi];W[hh];B[fk];\nW[fj];B[ek];W[fi];B[fh];W[eh];B[di];W[ke];B[kl];W[ll];B[km];W[ij];B[lk];W[kj];\nB[ml];W[lj];B[qr];W[mk];B[cd];W[bc];B[de];W[cb];B[ei];W[gh];B[fg];W[ff];B[eg];\nW[eo];B[dn];W[sj];B[rn];W[lm];B[gg];W[lc];B[jc];W[gb];B[gc];W[fc];B[hb];W[eb];\nB[ga];W[sb];B[mm];W[ln])\n";
const GLOBAL_GROUPS = {"global": ["tenuki_ok", "urgent_local"], "initiative": ["play_sente", "take_sente", "reverse_sente", "play_gote"]};
const SPATIAL_GROUPS = {"strategic": ["building_viable", "influence_viable", "profit_viable", "invasion_viable", "reduction_viable", "fight_viable", "must_live"], "tactical": ["approach_opp_corner", "enclose_own_corner", "inside_opp_corner", "extend_side", "expand_while_reducing", "connect", "get_base", "jump_into_center", "throw_in", "make_eyes", "steal_eyes", "pincer", "cut_available", "peep_available", "ladder_present", "atari_available", "ko_threat", "capture_race", "use_aji", "ladder_breaker"], "location": ["left_side", "upper_side", "right_side", "lower_side", "tl_corner", "tr_corner", "bl_corner", "br_corner", "center"], "shape": ["play_lightly", "good_shape", "bad_shape", "joseki", "hane", "extension", "descend"]};
const POLICY = {"0": {"suggestions": [{"move": "C16", "winrate": 0.34302639961242676, "policy_prob": 0.07380878925323486}, {"move": "C4", "winrate": 0.3420748710632324, "policy_prob": 0.06969533860683441}, {"move": "D17", "winrate": 0.3415808081626892, "policy_prob": 0.06592973321676254}, {"move": "R4", "winrate": 0.33825141191482544, "policy_prob": 0.062088169157505035}, {"move": "Q17", "winrate": 0.3394845724105835, "policy_prob": 0.06009944528341293}, {"move": "D4", "winrate": 0.3151039481163025, "policy_prob": 0.06566181778907776, "is_actual_move": true}], "actual_move": {"move": "D4", "winrate": 0.31510424613952637, "policy_prob": 0.06566181778907776, "player": "b"}}, "1": {"suggestions": [{"move": "Q16", "winrate": 0.6702854037284851, "policy_prob": 0.28218355774879456}, {"move": "D16", "winrate": 0.6533015072345734, "policy_prob": 0.29808884859085083, "is_actual_move": true}], "actual_move": {"move": "D16", "winrate": 0.6533015072345734, "policy_prob": 0.29808884859085083, "player": "w"}}, "2": {"suggestions": [{"move": "Q4", "winrate": 0.3408682346343994, "policy_prob": 0.399740070104599}], "actual_move": {"move": "Q4", "winrate": 0.3408682346343994, "policy_prob": 0.399740070104599, "player": "b"}}, "3": {"suggestions": [{"move": "Q16", "winrate": 0.6349747776985168, "policy_prob": 0.8087853193283081}, {"move": "R16", "winrate": 0.6357111930847168, "policy_prob": 0.08162473142147064}, {"move": "Q17", "winrate": 0.6360359489917755, "policy_prob": 0.03543008491396904}], "actual_move": {"move": "Q16", "winrate": 0.6349747776985168, "policy_prob": 0.8087853193283081, "player": "w"}}, "4": {"suggestions": [{"move": "C14", "winrate": 0.3548298478126526, "policy_prob": 0.3509114682674408}, {"move": "O17", "winrate": 0.35395288467407227, "policy_prob": 0.048621486872434616}, {"move": "F17", "winrate": 0.35694873332977295, "policy_prob": 0.04466836154460907}], "actual_move": {"move": "C14", "winrate": 0.3548298478126526, "policy_prob": 0.3509114682674408, "player": "b"}}, "5": {"suggestions": [{"move": "C3", "winrate": 0.6637422740459442, "policy_prob": 0.11135588586330414}, {"move": "R3", "winrate": 0.6578705608844757, "policy_prob": 0.3759322464466095, "is_actual_move": true}], "actual_move": {"move": "R3", "winrate": 0.6578706800937653, "policy_prob": 0.3759322464466095, "player": "w"}}, "6": {"suggestions": [{"move": "R4", "winrate": 0.39481866359710693, "policy_prob": 0.8198651075363159}], "actual_move": {"move": "R4", "winrate": 0.39481866359710693, "policy_prob": 0.8198651075363159, "player": "b"}}, "7": {"suggestions": [{"move": "Q3", "winrate": 0.6418391466140747, "policy_prob": 0.9889495372772217}], "actual_move": {"move": "Q3", "winrate": 0.6418391466140747, "policy_prob": 0.9889495372772217, "player": "w"}}, "8": {"suggestions": [{"move": "P4", "winrate": 0.3719485402107239, "policy_prob": 0.9096118807792664}], "actual_move": {"move": "P4", "winrate": 0.3719485402107239, "policy_prob": 0.9096118807792664, "player": "b"}}, "9": {"suggestions": [{"move": "P3", "winrate": 0.6563354432582855, "policy_prob": 0.33560842275619507}, {"move": "O3", "winrate": 0.6538214981555939, "policy_prob": 0.03780670464038849}, {"move": "O2", "winrate": 0.6428819298744202, "policy_prob": 0.6145411729812622, "is_actual_move": true}], "actual_move": {"move": "O2", "winrate": 0.6428819298744202, "policy_prob": 0.6145411729812622, "player": "w"}}, "10": {"suggestions": [{"move": "O17", "winrate": 0.37431442737579346, "policy_prob": 0.6192885637283325}], "actual_move": {"move": "O17", "winrate": 0.37431448698043823, "policy_prob": 0.6192885637283325, "player": "b"}}, "11": {"suggestions": [{"move": "F16", "winrate": 0.6611455082893372, "policy_prob": 0.19248928129673004}, {"move": "F17", "winrate": 0.6632792055606842, "policy_prob": 0.1306179314851761}, {"move": "L17", "winrate": 0.6659707129001617, "policy_prob": 0.03530331701040268}, {"move": "O16", "winrate": 0.6610347032546997, "policy_prob": 0.021479532122612}, {"move": "C15", "winrate": 0.6509009003639221, "policy_prob": 0.2632350027561188, "is_actual_move": true}], "actual_move": {"move": "C15", "winrate": 0.6509009003639221, "policy_prob": 0.2632350027561188, "player": "w"}}, "12": {"suggestions": [{"move": "D14", "winrate": 0.354755163192749, "policy_prob": 0.9133983254432678}, {"move": "O3", "winrate": 0.3525369167327881, "policy_prob": 0.008999408222734928}], "actual_move": {"move": "D14", "winrate": 0.354755163192749, "policy_prob": 0.9133983254432678, "player": "b"}}, "13": {"suggestions": [{"move": "F16", "winrate": 0.6603425741195679, "policy_prob": 0.9017606973648071}], "actual_move": {"move": "F16", "winrate": 0.6603425741195679, "policy_prob": 0.9017606973648071, "player": "w"}}, "14": {"suggestions": [{"move": "D10", "winrate": 0.3619270920753479, "policy_prob": 0.07959381490945816}, {"move": "R14", "winrate": 0.32923585176467896, "policy_prob": 0.7687759399414062, "is_actual_move": true}], "actual_move": {"move": "R14", "winrate": 0.3292359709739685, "policy_prob": 0.7687759399414062, "player": "b"}}, "15": {"suggestions": [{"move": "O16", "winrate": 0.6552551090717316, "policy_prob": 0.8245080709457397}], "actual_move": {"move": "O16", "winrate": 0.6552551090717316, "policy_prob": 0.8245080709457397, "player": "w"}}, "16": {"suggestions": [{"move": "N16", "winrate": 0.3493267893791199, "policy_prob": 0.9493427276611328}], "actual_move": {"move": "N16", "winrate": 0.3493267893791199, "policy_prob": 0.9493427276611328, "player": "b"}}, "17": {"suggestions": [{"move": "O15", "winrate": 0.6528168022632599, "policy_prob": 0.9577004313468933}], "actual_move": {"move": "O15", "winrate": 0.6528168022632599, "policy_prob": 0.9577004313468933, "player": "w"}}, "18": {"suggestions": [{"move": "Q17", "winrate": 0.3413242697715759, "policy_prob": 0.9059609770774841}, {"move": "P18", "winrate": 0.33709341287612915, "policy_prob": 0.023362787440419197}], "actual_move": {"move": "Q17", "winrate": 0.3413242697715759, "policy_prob": 0.9059609770774841, "player": "b"}}, "19": {"suggestions": [{"move": "P17", "winrate": 0.6586017906665802, "policy_prob": 0.007815801538527012}, {"move": "R17", "winrate": 0.6534076631069183, "policy_prob": 0.9695206880569458, "is_actual_move": true}], "actual_move": {"move": "R17", "winrate": 0.6534076631069183, "policy_prob": 0.9695206880569458, "player": "w"}}, "20": {"suggestions": [{"move": "P17", "winrate": 0.34335386753082275, "policy_prob": 0.9861071109771729}], "actual_move": {"move": "P17", "winrate": 0.34335386753082275, "policy_prob": 0.9861071109771729, "player": "b"}}, "21": {"suggestions": [{"move": "S16", "winrate": 0.6620181798934937, "policy_prob": 0.09933661669492722}, {"move": "R16", "winrate": 0.6629197001457214, "policy_prob": 0.0728280171751976}, {"move": "Q14", "winrate": 0.6511909663677216, "policy_prob": 0.8189605474472046, "is_actual_move": true}], "actual_move": {"move": "Q14", "winrate": 0.6511909663677216, "policy_prob": 0.8189605474472046, "player": "w"}}, "22": {"suggestions": [{"move": "P16", "winrate": 0.37489306926727295, "policy_prob": 0.13970158994197845}, {"move": "D10", "winrate": 0.36084699630737305, "policy_prob": 0.5495026707649231, "is_actual_move": true}], "actual_move": {"move": "D10", "winrate": 0.3608472943305969, "policy_prob": 0.5495026707649231, "player": "b"}}, "23": {"suggestions": [{"move": "R13", "winrate": 0.6505398154258728, "policy_prob": 0.42252689599990845}], "actual_move": {"move": "R13", "winrate": 0.6505400538444519, "policy_prob": 0.42252689599990845, "player": "w"}}, "24": {"suggestions": [{"move": "P16", "winrate": 0.3621554374694824, "policy_prob": 0.9340897798538208}], "actual_move": {"move": "P16", "winrate": 0.3621554374694824, "policy_prob": 0.9340897798538208, "player": "b"}}, "25": {"suggestions": [{"move": "P15", "winrate": 0.676575243473053, "policy_prob": 0.9133338332176208}], "actual_move": {"move": "P15", "winrate": 0.676575243473053, "policy_prob": 0.9133338332176208, "player": "w"}}, "26": {"suggestions": [{"move": "R16", "winrate": 0.37455224990844727, "policy_prob": 0.9850600361824036}], "actual_move": {"move": "R16", "winrate": 0.37455224990844727, "policy_prob": 0.9850600361824036, "player": "b"}}, "27": {"suggestions": [{"move": "Q15", "winrate": 0.6820621192455292, "policy_prob": 0.9935048818588257}], "actual_move": {"move": "Q15", "winrate": 0.6820621192455292, "policy_prob": 0.9935048818588257, "player": "w"}}, "28": {"suggestions": [{"move": "R18", "winrate": 0.3831756114959717, "policy_prob": 0.9897409677505493}], "actual_move": {"move": "R18", "winrate": 0.3831756114959717, "policy_prob": 0.9897409677505493, "player": "b"}}, "29": {"suggestions": [{"move": "S17", "winrate": 0.6617704331874847, "policy_prob": 0.9920433163642883}], "actual_move": {"move": "S17", "winrate": 0.6617704331874847, "policy_prob": 0.9920433163642883, "player": "w"}}, "30": {"suggestions": [{"move": "S18", "winrate": 0.38315850496292114, "policy_prob": 0.9077826738357544}], "actual_move": {"move": "S18", "winrate": 0.38315850496292114, "policy_prob": 0.9077826738357544, "player": "b"}}, "31": {"suggestions": [{"move": "S16", "winrate": 0.6600269675254822, "policy_prob": 0.9903720617294312}], "actual_move": {"move": "S16", "winrate": 0.6600269675254822, "policy_prob": 0.9903720617294312, "player": "w"}}, "32": {"suggestions": [{"move": "R12", "winrate": 0.39910805225372314, "policy_prob": 0.45996513962745667}, {"move": "H17", "winrate": 0.3430590033531189, "policy_prob": 0.45215222239494324, "is_actual_move": true}], "actual_move": {"move": "H17", "winrate": 0.3430590033531189, "policy_prob": 0.45215222239494324, "player": "b"}}, "33": {"suggestions": [{"move": "H16", "winrate": 0.6878004968166351, "policy_prob": 0.4725564122200012}], "actual_move": {"move": "H16", "winrate": 0.6878007352352142, "policy_prob": 0.4725564122200012, "player": "w"}}, "34": {"suggestions": [{"move": "R12", "winrate": 0.4011881351470947, "policy_prob": 0.3833639919757843}, {"move": "J16", "winrate": 0.3447803854942322, "policy_prob": 0.45782312750816345, "is_actual_move": true}], "actual_move": {"move": "J16", "winrate": 0.3447803854942322, "policy_prob": 0.45782312750816345, "player": "b"}}, "35": {"suggestions": [{"move": "H15", "winrate": 0.6870004236698151, "policy_prob": 0.8873203992843628}], "actual_move": {"move": "H15", "winrate": 0.6870004236698151, "policy_prob": 0.8873203992843628, "player": "w"}}, "36": {"suggestions": [{"move": "R12", "winrate": 0.39012670516967773, "policy_prob": 0.26896849274635315}, {"move": "J17", "winrate": 0.3136475086212158, "policy_prob": 0.2892058491706848, "is_actual_move": true}], "actual_move": {"move": "J17", "winrate": 0.31364744901657104, "policy_prob": 0.2892058491706848, "player": "b"}}, "37": {"suggestions": [{"move": "B12", "winrate": 0.6775540113449097, "policy_prob": 0.2457210272550583}, {"move": "C3", "winrate": 0.6464037001132965, "policy_prob": 0.36404502391815186, "is_actual_move": true}], "actual_move": {"move": "C3", "winrate": 0.6464037895202637, "policy_prob": 0.36404502391815186, "player": "w"}}, "38": {"suggestions": [{"move": "R12", "winrate": 0.3957456350326538, "policy_prob": 0.44017693400382996}, {"move": "C4", "winrate": 0.3423978090286255, "policy_prob": 0.4955645799636841, "is_actual_move": true}], "actual_move": {"move": "C4", "winrate": 0.3423978090286255, "policy_prob": 0.4955645799636841, "player": "b"}}, "39": {"suggestions": [{"move": "D3", "winrate": 0.6516734659671783, "policy_prob": 0.9924359917640686}], "actual_move": {"move": "D3", "winrate": 0.6516734659671783, "policy_prob": 0.9924359917640686, "player": "w"}}, "40": {"suggestions": [{"move": "R12", "winrate": 0.3696826696395874, "policy_prob": 0.24012093245983124}, {"move": "E4", "winrate": 0.3484644889831543, "policy_prob": 0.4042172133922577, "is_actual_move": true}], "actual_move": {"move": "E4", "winrate": 0.3484644889831543, "policy_prob": 0.4042172133922577, "player": "b"}}, "41": {"suggestions": [{"move": "F2", "winrate": 0.6680767834186554, "policy_prob": 0.8491696119308472}], "actual_move": {"move": "F2", "winrate": 0.6680767834186554, "policy_prob": 0.8491696119308472, "player": "w"}}, "42": {"suggestions": [{"move": "E17", "winrate": 0.3709315061569214, "policy_prob": 0.0393865704536438}, {"move": "F18", "winrate": 0.3538395166397095, "policy_prob": 0.3008006513118744, "is_actual_move": true}], "actual_move": {"move": "F18", "winrate": 0.3538393974304199, "policy_prob": 0.3008006513118744, "player": "b"}}, "43": {"suggestions": [{"move": "B14", "winrate": 0.6760204136371613, "policy_prob": 0.06104661896824837}, {"move": "D18", "winrate": 0.66937255859375, "policy_prob": 0.5092985033988953, "is_actual_move": true}], "actual_move": {"move": "D18", "winrate": 0.6693724989891052, "policy_prob": 0.5092985033988953, "player": "w"}}, "44": {"suggestions": [{"move": "E17", "winrate": 0.35070914030075073, "policy_prob": 0.4633156955242157}], "actual_move": {"move": "E17", "winrate": 0.3507090210914612, "policy_prob": 0.4633156955242157, "player": "b"}}, "45": {"suggestions": [{"move": "E16", "winrate": 0.6659192740917206, "policy_prob": 0.8611624240875244}], "actual_move": {"move": "E16", "winrate": 0.6659192740917206, "policy_prob": 0.8611624240875244, "player": "w"}}, "46": {"suggestions": [{"move": "C17", "winrate": 0.3851901888847351, "policy_prob": 0.553451418876648}], "actual_move": {"move": "C17", "winrate": 0.3851901888847351, "policy_prob": 0.553451418876648, "player": "b"}}, "47": {"suggestions": [{"move": "D17", "winrate": 0.7091761529445648, "policy_prob": 0.9704636335372925}], "actual_move": {"move": "D17", "winrate": 0.7091761529445648, "policy_prob": 0.9704636335372925, "player": "w"}}, "48": {"suggestions": [{"move": "R12", "winrate": 0.3774712085723877, "policy_prob": 0.24490953981876373}, {"move": "B15", "winrate": 0.35791724920272827, "policy_prob": 0.7048454284667969, "is_actual_move": true}], "actual_move": {"move": "B15", "winrate": 0.35791724920272827, "policy_prob": 0.7048454284667969, "player": "b"}}, "49": {"suggestions": [{"move": "M16", "winrate": 0.7067545652389526, "policy_prob": 0.046169769018888474}, {"move": "B14", "winrate": 0.6853274703025818, "policy_prob": 0.2524286210536957, "is_actual_move": true}], "actual_move": {"move": "B14", "winrate": 0.6853272616863251, "policy_prob": 0.2524286210536957, "player": "w"}}, "50": {"suggestions": [{"move": "B13", "winrate": 0.363241970539093, "policy_prob": 0.8294715881347656}], "actual_move": {"move": "B13", "winrate": 0.363241970539093, "policy_prob": 0.8294715881347656, "player": "b"}}, "51": {"suggestions": [{"move": "B16", "winrate": 0.7145826816558838, "policy_prob": 0.9139084219932556}], "actual_move": {"move": "B16", "winrate": 0.7145826816558838, "policy_prob": 0.9139084219932556, "player": "w"}}, "52": {"suggestions": [{"move": "A14", "winrate": 0.36799418926239014, "policy_prob": 0.5909282565116882}], "actual_move": {"move": "A14", "winrate": 0.36799418926239014, "policy_prob": 0.5909282565116882, "player": "b"}}, "53": {"suggestions": [{"move": "Q8", "winrate": 0.7094832062721252, "policy_prob": 0.3027113378047943}, {"move": "L16", "winrate": 0.6849902272224426, "policy_prob": 0.31898194551467896, "is_actual_move": true}], "actual_move": {"move": "L16", "winrate": 0.6849902868270874, "policy_prob": 0.31898194551467896, "player": "w"}}, "54": {"suggestions": [{"move": "M16", "winrate": 0.38757115602493286, "policy_prob": 0.4287382662296295}], "actual_move": {"move": "M16", "winrate": 0.38757163286209106, "policy_prob": 0.4287382662296295, "player": "b"}}, "55": {"suggestions": [{"move": "L14", "winrate": 0.666734129190445, "policy_prob": 0.23276221752166748}, {"move": "L15", "winrate": 0.66618612408638, "policy_prob": 0.2170364111661911}, {"move": "M17", "winrate": 0.6632496118545532, "policy_prob": 0.16796842217445374}], "actual_move": {"move": "L14", "winrate": 0.666733980178833, "policy_prob": 0.23276221752166748, "player": "w"}}, "56": {"suggestions": [{"move": "L17", "winrate": 0.41339200735092163, "policy_prob": 0.6997746825218201}], "actual_move": {"move": "L17", "winrate": 0.41339200735092163, "policy_prob": 0.6997746825218201, "player": "b"}}, "57": {"suggestions": [{"move": "Q8", "winrate": 0.696781724691391, "policy_prob": 0.5094567537307739}, {"move": "R8", "winrate": 0.6943499147891998, "policy_prob": 0.2710653841495514}], "actual_move": {"move": "Q8", "winrate": 0.696781724691391, "policy_prob": 0.5094567537307739, "player": "w"}}, "58": {"suggestions": [{"move": "R12", "winrate": 0.4546002149581909, "policy_prob": 0.5039504766464233}], "actual_move": {"move": "R12", "winrate": 0.4546002149581909, "policy_prob": 0.5039504766464233, "player": "b"}}, "59": {"suggestions": [{"move": "S13", "winrate": 0.7028628587722778, "policy_prob": 0.8197791576385498}], "actual_move": {"move": "S13", "winrate": 0.7028628587722778, "policy_prob": 0.8197791576385498, "player": "w"}}, "60": {"suggestions": [{"move": "O3", "winrate": 0.47231805324554443, "policy_prob": 0.4216582179069519}], "actual_move": {"move": "O3", "winrate": 0.47231805324554443, "policy_prob": 0.4216582179069519, "player": "b"}}, "61": {"suggestions": [{"move": "N3", "winrate": 0.6904697418212891, "policy_prob": 0.2894289195537567}, {"move": "N2", "winrate": 0.6556553244590759, "policy_prob": 0.37206634879112244, "is_actual_move": true}], "actual_move": {"move": "N2", "winrate": 0.6556553244590759, "policy_prob": 0.37206634879112244, "player": "w"}}, "62": {"suggestions": [{"move": "R8", "winrate": 0.490200400352478, "policy_prob": 0.6751609444618225}, {"move": "S3", "winrate": 0.4881059527397156, "policy_prob": 0.17735905945301056}], "actual_move": {"move": "R8", "winrate": 0.49020057916641235, "policy_prob": 0.6751609444618225, "player": "b"}}, "63": {"suggestions": [{"move": "R9", "winrate": 0.6236108839511871, "policy_prob": 0.5687730312347412}], "actual_move": {"move": "R9", "winrate": 0.6236108839511871, "policy_prob": 0.5687730312347412, "player": "w"}}, "64": {"suggestions": [{"move": "S3", "winrate": 0.504193514585495, "policy_prob": 0.27038413286209106}, {"move": "Q9", "winrate": 0.41555899381637573, "policy_prob": 0.41025713086128235, "is_actual_move": true}], "actual_move": {"move": "Q9", "winrate": 0.4155588746070862, "policy_prob": 0.41025713086128235, "player": "b"}}, "65": {"suggestions": [{"move": "R7", "winrate": 0.6396600008010864, "policy_prob": 0.4906066358089447}, {"move": "R10", "winrate": 0.6382273733615875, "policy_prob": 0.3371182680130005}], "actual_move": {"move": "R7", "winrate": 0.6396600008010864, "policy_prob": 0.4906066358089447, "player": "w"}}, "66": {"suggestions": [{"move": "S8", "winrate": 0.5116975903511047, "policy_prob": 0.7984851598739624}], "actual_move": {"move": "S8", "winrate": 0.5116975903511047, "policy_prob": 0.7984851598739624, "player": "b"}}, "67": {"suggestions": [{"move": "S7", "winrate": 0.6364880800247192, "policy_prob": 0.43412360548973083}, {"move": "S5", "winrate": 0.6345919668674469, "policy_prob": 0.1327127367258072}], "actual_move": {"move": "S7", "winrate": 0.6364880800247192, "policy_prob": 0.43412360548973083, "player": "w"}}, "68": {"suggestions": [{"move": "S3", "winrate": 0.4778599143028259, "policy_prob": 0.40565550327301025}], "actual_move": {"move": "S3", "winrate": 0.4778599143028259, "policy_prob": 0.40565550327301025, "player": "b"}}, "69": {"suggestions": [{"move": "P9", "winrate": 0.6340228617191315, "policy_prob": 0.4987250864505768}], "actual_move": {"move": "P9", "winrate": 0.6340226233005524, "policy_prob": 0.4987250864505768, "player": "w"}}, "70": {"suggestions": [{"move": "P2", "winrate": 0.5193946361541748, "policy_prob": 0.5410764813423157}], "actual_move": {"move": "P2", "winrate": 0.5193946361541748, "policy_prob": 0.5410764813423157, "player": "b"}}, "71": {"suggestions": [{"move": "G3", "winrate": 0.6214107275009155, "policy_prob": 0.3562440574169159}], "actual_move": {"move": "G3", "winrate": 0.6214105784893036, "policy_prob": 0.3562440574169159, "player": "w"}}, "72": {"suggestions": [{"move": "Q10", "winrate": 0.5758134126663208, "policy_prob": 0.25726038217544556}], "actual_move": {"move": "Q10", "winrate": 0.5758132636547089, "policy_prob": 0.25726038217544556, "player": "b"}}, "73": {"suggestions": [{"move": "P10", "winrate": 0.5906659662723541, "policy_prob": 0.5231476426124573}], "actual_move": {"move": "P10", "winrate": 0.5906659662723541, "policy_prob": 0.5231476426124573, "player": "w"}}, "74": {"suggestions": [{"move": "Q7", "winrate": 0.7224957644939423, "policy_prob": 0.21005257964134216}], "actual_move": {"move": "Q7", "winrate": 0.7224956154823303, "policy_prob": 0.21005257964134216, "player": "b"}}, "75": {"suggestions": [{"move": "P8", "winrate": 0.46439486742019653, "policy_prob": 0.9945077300071716}], "actual_move": {"move": "P8", "winrate": 0.46439486742019653, "policy_prob": 0.9945077300071716, "player": "w"}}, "76": {"suggestions": [{"move": "S9", "winrate": 0.7081243395805359, "policy_prob": 0.9419277310371399}], "actual_move": {"move": "S9", "winrate": 0.7081243395805359, "policy_prob": 0.9419277310371399, "player": "b"}}, "77": {"suggestions": [{"move": "R10", "winrate": 0.5030435919761658, "policy_prob": 0.8962387442588806}], "actual_move": {"move": "R10", "winrate": 0.5030435919761658, "policy_prob": 0.8962387442588806, "player": "w"}}, "78": {"suggestions": [{"move": "R6", "winrate": 0.6274701356887817, "policy_prob": 0.207197368144989}, {"move": "S10", "winrate": 0.6090733110904694, "policy_prob": 0.6565927267074585, "is_actual_move": true}], "actual_move": {"move": "S10", "winrate": 0.6090735197067261, "policy_prob": 0.6565927267074585, "player": "b"}}, "79": {"suggestions": [{"move": "Q11", "winrate": 0.5348844528198242, "policy_prob": 0.992968738079071}], "actual_move": {"move": "Q11", "winrate": 0.5348844528198242, "policy_prob": 0.992968738079071, "player": "w"}}, "80": {"suggestions": [{"move": "Q6", "winrate": 0.7634957581758499, "policy_prob": 0.7301509976387024}], "actual_move": {"move": "Q6", "winrate": 0.7634957581758499, "policy_prob": 0.7301509976387024, "player": "b"}}, "81": {"suggestions": [{"move": "S5", "winrate": 0.5072214603424072, "policy_prob": 0.0568610243499279}, {"move": "S11", "winrate": 0.33804619312286377, "policy_prob": 0.5579805970191956, "is_actual_move": true}], "actual_move": {"move": "S11", "winrate": 0.33804577589035034, "policy_prob": 0.5579805970191956, "player": "w"}}, "82": {"suggestions": [{"move": "R6", "winrate": 0.7912243604660034, "policy_prob": 0.5702903270721436}], "actual_move": {"move": "R6", "winrate": 0.7912243604660034, "policy_prob": 0.5702903270721436, "player": "b"}}, "83": {"suggestions": [{"move": "S2", "winrate": 0.35046058893203735, "policy_prob": 0.08271536976099014}, {"move": "D8", "winrate": 0.31513088941574097, "policy_prob": 0.4910711944103241, "is_actual_move": true}], "actual_move": {"move": "D8", "winrate": 0.31513118743896484, "policy_prob": 0.4910711944103241, "player": "w"}}, "84": {"suggestions": [{"move": "B3", "winrate": 0.8017443120479584, "policy_prob": 0.40430861711502075}], "actual_move": {"move": "B3", "winrate": 0.8017443865537643, "policy_prob": 0.40430861711502075, "player": "b"}}, "85": {"suggestions": [{"move": "B2", "winrate": 0.3098223805427551, "policy_prob": 0.9179620742797852}], "actual_move": {"move": "B2", "winrate": 0.3098223805427551, "policy_prob": 0.9179620742797852, "player": "w"}}, "86": {"suggestions": [{"move": "B5", "winrate": 0.8215415626764297, "policy_prob": 0.7194230556488037}], "actual_move": {"move": "B5", "winrate": 0.8215416520833969, "policy_prob": 0.7194230556488037, "player": "b"}}, "87": {"suggestions": [{"move": "A3", "winrate": 0.33137547969818115, "policy_prob": 0.6794458627700806}], "actual_move": {"move": "A3", "winrate": 0.3313753604888916, "policy_prob": 0.6794458627700806, "player": "w"}}, "88": {"suggestions": [{"move": "E7", "winrate": 0.8106532245874405, "policy_prob": 0.1730317771434784}, {"move": "G4", "winrate": 0.7574802190065384, "policy_prob": 0.39497110247612, "is_actual_move": true}], "actual_move": {"move": "G4", "winrate": 0.7574803084135056, "policy_prob": 0.39497110247612, "player": "b"}}, "89": {"suggestions": [{"move": "F8", "winrate": 0.3539617657661438, "policy_prob": 0.08079221099615097}, {"move": "H4", "winrate": 0.348222017288208, "policy_prob": 0.6622121930122375, "is_actual_move": true}], "actual_move": {"move": "H4", "winrate": 0.3482215404510498, "policy_prob": 0.6622121930122375, "player": "w"}}, "90": {"suggestions": [{"move": "H5", "winrate": 0.7287218570709229, "policy_prob": 0.5098246932029724}], "actual_move": {"move": "H5", "winrate": 0.7287221848964691, "policy_prob": 0.5098246932029724, "player": "b"}}, "91": {"suggestions": [{"move": "F8", "winrate": 0.3870922923088074, "policy_prob": 0.26271480321884155}, {"move": "F4", "winrate": 0.3764960765838623, "policy_prob": 0.33174794912338257, "is_actual_move": true}], "actual_move": {"move": "F4", "winrate": 0.3764960765838623, "policy_prob": 0.33174794912338257, "player": "w"}}, "92": {"suggestions": [{"move": "G5", "winrate": 0.7651398628950119, "policy_prob": 0.8974390625953674}], "actual_move": {"move": "G5", "winrate": 0.7651398628950119, "policy_prob": 0.8974390625953674, "player": "b"}}, "93": {"suggestions": [{"move": "F5", "winrate": 0.3598443865776062, "policy_prob": 0.9757670760154724}], "actual_move": {"move": "F5", "winrate": 0.3598443865776062, "policy_prob": 0.9757670760154724, "player": "w"}}, "94": {"suggestions": [{"move": "E7", "winrate": 0.7790289670228958, "policy_prob": 0.36182230710983276}, {"move": "E3", "winrate": 0.7515548020601273, "policy_prob": 0.4234860837459564, "is_actual_move": true}], "actual_move": {"move": "E3", "winrate": 0.7515548020601273, "policy_prob": 0.4234860837459564, "player": "b"}}, "95": {"suggestions": [{"move": "F3", "winrate": 0.36379581689834595, "policy_prob": 0.8105809092521667}], "actual_move": {"move": "F3", "winrate": 0.36379581689834595, "policy_prob": 0.8105809092521667, "player": "w"}}, "96": {"suggestions": [{"move": "E7", "winrate": 0.7321835160255432, "policy_prob": 0.3448595702648163}], "actual_move": {"move": "E7", "winrate": 0.7321835160255432, "policy_prob": 0.3448595702648163, "player": "b"}}, "97": {"suggestions": [{"move": "E8", "winrate": 0.41090381145477295, "policy_prob": 0.47010794281959534}], "actual_move": {"move": "E8", "winrate": 0.4109039306640625, "policy_prob": 0.47010794281959534, "player": "w"}}, "98": {"suggestions": [{"move": "F7", "winrate": 0.7081092298030853, "policy_prob": 0.25120416283607483}], "actual_move": {"move": "F7", "winrate": 0.7081093192100525, "policy_prob": 0.25120416283607483, "player": "b"}}, "99": {"suggestions": [{"move": "D7", "winrate": 0.4728480577468872, "policy_prob": 0.484520822763443}], "actual_move": {"move": "D7", "winrate": 0.472848117351532, "policy_prob": 0.484520822763443, "player": "w"}}, "100": {"suggestions": [{"move": "E6", "winrate": 0.7026553153991699, "policy_prob": 0.8709105849266052}], "actual_move": {"move": "E6", "winrate": 0.7026553153991699, "policy_prob": 0.8709105849266052, "player": "b"}}, "101": {"suggestions": [{"move": "F8", "winrate": 0.5263187885284424, "policy_prob": 0.668008029460907}], "actual_move": {"move": "F8", "winrate": 0.5263193249702454, "policy_prob": 0.668008029460907, "player": "w"}}, "102": {"suggestions": [{"move": "G8", "winrate": 0.7764415889978409, "policy_prob": 0.3699497580528259}], "actual_move": {"move": "G8", "winrate": 0.7764415889978409, "policy_prob": 0.3699497580528259, "player": "b"}}, "103": {"suggestions": [{"move": "C6", "winrate": 0.43752169609069824, "policy_prob": 0.06445671617984772}, {"move": "G9", "winrate": 0.3716302514076233, "policy_prob": 0.24293363094329834, "is_actual_move": true}], "actual_move": {"move": "G9", "winrate": 0.3716302514076233, "policy_prob": 0.24293363094329834, "player": "w"}}, "104": {"suggestions": [{"move": "H7", "winrate": 0.8796341121196747, "policy_prob": 0.4285450279712677}], "actual_move": {"move": "H7", "winrate": 0.8796340301632881, "policy_prob": 0.4285450279712677, "player": "b"}}, "105": {"suggestions": [{"move": "H8", "winrate": 0.34358370304107666, "policy_prob": 0.17258352041244507}, {"move": "J4", "winrate": 0.257271945476532, "policy_prob": 0.3894846439361572, "is_actual_move": true}], "actual_move": {"move": "J4", "winrate": 0.25727105140686035, "policy_prob": 0.3894846439361572, "player": "w"}}, "106": {"suggestions": [{"move": "H9", "winrate": 0.9001888930797577, "policy_prob": 0.4619065821170807}], "actual_move": {"move": "H9", "winrate": 0.9001887515187263, "policy_prob": 0.4619065821170807, "player": "b"}}, "107": {"suggestions": [{"move": "C6", "winrate": 0.26907700300216675, "policy_prob": 0.054605744779109955}, {"move": "G10", "winrate": 0.25686192512512207, "policy_prob": 0.7767289876937866, "is_actual_move": true}], "actual_move": {"move": "G10", "winrate": 0.25686192512512207, "policy_prob": 0.7767289876937866, "player": "w"}}, "108": {"suggestions": [{"move": "L3", "winrate": 0.905747540295124, "policy_prob": 0.3512819707393646}], "actual_move": {"move": "L3", "winrate": 0.905747152864933, "policy_prob": 0.3512819707393646, "player": "b"}}, "109": {"suggestions": [{"move": "N3", "winrate": 0.17954450845718384, "policy_prob": 0.37508872151374817}, {"move": "C6", "winrate": 0.17896699905395508, "policy_prob": 0.017251554876565933}], "actual_move": {"move": "N3", "winrate": 0.17954415082931519, "policy_prob": 0.37508872151374817, "player": "w"}}, "110": {"suggestions": [{"move": "E2", "winrate": 0.9397989623248577, "policy_prob": 0.22702236473560333}, {"move": "L5", "winrate": 0.8816511034965515, "policy_prob": 0.37873658537864685, "is_actual_move": true}], "actual_move": {"move": "L5", "winrate": 0.881651408970356, "policy_prob": 0.37873658537864685, "player": "b"}}, "111": {"suggestions": [{"move": "D6", "winrate": 0.20433372259140015, "policy_prob": 0.02311769500374794}, {"move": "P3", "winrate": 0.1550922989845276, "policy_prob": 0.23205222189426422, "is_actual_move": true}], "actual_move": {"move": "P3", "winrate": 0.1550922989845276, "policy_prob": 0.23205222189426422, "player": "w"}}, "112": {"suggestions": [{"move": "E2", "winrate": 0.9373721852898598, "policy_prob": 0.5353456735610962}], "actual_move": {"move": "E2", "winrate": 0.9373721852898598, "policy_prob": 0.5353456735610962, "player": "b"}}, "113": {"suggestions": [{"move": "B4", "winrate": 0.20498567819595337, "policy_prob": 0.5748755931854248}], "actual_move": {"move": "B4", "winrate": 0.20498597621917725, "policy_prob": 0.5748755931854248, "player": "w"}}, "114": {"suggestions": [{"move": "J2", "winrate": 0.9795179031789303, "policy_prob": 0.27272236347198486}, {"move": "K2", "winrate": 0.9802905563265085, "policy_prob": 0.09869362413883209}, {"move": "C6", "winrate": 0.7528386861085892, "policy_prob": 0.3017842173576355, "is_actual_move": true}], "actual_move": {"move": "C6", "winrate": 0.7528386861085892, "policy_prob": 0.3017842173576355, "player": "b"}}, "115": {"suggestions": [{"move": "D2", "winrate": 0.31000375747680664, "policy_prob": 0.6443839073181152}], "actual_move": {"move": "D2", "winrate": 0.31000375747680664, "policy_prob": 0.6443839073181152, "player": "w"}}, "116": {"suggestions": [{"move": "K2", "winrate": 0.9122254848480225, "policy_prob": 0.16076311469078064}, {"move": "E1", "winrate": 0.783740445971489, "policy_prob": 0.20807676017284393, "is_actual_move": true}], "actual_move": {"move": "E1", "winrate": 0.7837405651807785, "policy_prob": 0.20807676017284393, "player": "b"}}, "117": {"suggestions": [{"move": "J2", "winrate": 0.3935062289237976, "policy_prob": 0.3793669641017914}], "actual_move": {"move": "J2", "winrate": 0.3935060501098633, "policy_prob": 0.3793669641017914, "player": "w"}}, "118": {"suggestions": [{"move": "K2", "winrate": 0.8469063937664032, "policy_prob": 0.2603217661380768}, {"move": "O4", "winrate": 0.8193021863698959, "policy_prob": 0.27545100450515747, "is_actual_move": true}], "actual_move": {"move": "O4", "winrate": 0.8193019032478333, "policy_prob": 0.27545100450515747, "player": "b"}}, "119": {"suggestions": [{"move": "L4", "winrate": 0.34716349840164185, "policy_prob": 0.07484886050224304}, {"move": "Q2", "winrate": 0.30723142623901367, "policy_prob": 0.6766573190689087, "is_actual_move": true}], "actual_move": {"move": "Q2", "winrate": 0.3072320818901062, "policy_prob": 0.6766573190689087, "player": "w"}}, "120": {"suggestions": [{"move": "K2", "winrate": 0.9032925218343735, "policy_prob": 0.3248187005519867}, {"move": "L2", "winrate": 0.8620383590459824, "policy_prob": 0.4579273462295532, "is_actual_move": true}], "actual_move": {"move": "L2", "winrate": 0.8620384335517883, "policy_prob": 0.4579273462295532, "player": "b"}}, "121": {"suggestions": [{"move": "L4", "winrate": 0.33848804235458374, "policy_prob": 0.26958993077278137}, {"move": "K4", "winrate": 0.3343304395675659, "policy_prob": 0.02074640616774559}], "actual_move": {"move": "L4", "winrate": 0.3384872078895569, "policy_prob": 0.26958993077278137, "player": "w"}}, "122": {"suggestions": [{"move": "M4", "winrate": 0.7378775179386139, "policy_prob": 0.7475420832633972}], "actual_move": {"move": "M4", "winrate": 0.7378775179386139, "policy_prob": 0.7475420832633972, "player": "b"}}, "123": {"suggestions": [{"move": "K4", "winrate": 0.4030965566635132, "policy_prob": 0.8260993957519531}], "actual_move": {"move": "K4", "winrate": 0.4030965566635132, "policy_prob": 0.8260993957519531, "player": "w"}}, "124": {"suggestions": [{"move": "M3", "winrate": 0.7728968411684036, "policy_prob": 0.9189954400062561}], "actual_move": {"move": "M3", "winrate": 0.7728968411684036, "policy_prob": 0.9189954400062561, "player": "b"}}, "125": {"suggestions": [{"move": "M1", "winrate": 0.503130167722702, "policy_prob": 0.24201488494873047}, {"move": "J8", "winrate": 0.21963340044021606, "policy_prob": 0.38690364360809326, "is_actual_move": true}], "actual_move": {"move": "J8", "winrate": 0.21963322162628174, "policy_prob": 0.38690364360809326, "player": "w"}}, "126": {"suggestions": [{"move": "K6", "winrate": 0.8742016702890396, "policy_prob": 0.34830066561698914}], "actual_move": {"move": "K6", "winrate": 0.8742016106843948, "policy_prob": 0.34830066561698914, "player": "b"}}, "127": {"suggestions": [{"move": "M1", "winrate": 0.23524272441864014, "policy_prob": 0.13933558762073517}, {"move": "H2", "winrate": 0.1976720094680786, "policy_prob": 0.263849139213562, "is_actual_move": true}], "actual_move": {"move": "H2", "winrate": 0.1976720094680786, "policy_prob": 0.263849139213562, "player": "w"}}, "128": {"suggestions": [{"move": "S2", "winrate": 0.8161278814077377, "policy_prob": 0.9158340096473694}], "actual_move": {"move": "S2", "winrate": 0.8161278814077377, "policy_prob": 0.9158340096473694, "player": "b"}}, "129": {"suggestions": [{"move": "H8", "winrate": 0.5357363820075989, "policy_prob": 0.6063286662101746}], "actual_move": {"move": "H8", "winrate": 0.5357359051704407, "policy_prob": 0.6063286662101746, "player": "w"}}, "130": {"suggestions": [{"move": "G7", "winrate": 0.8083474487066269, "policy_prob": 0.9899909496307373}], "actual_move": {"move": "G7", "winrate": 0.8083474487066269, "policy_prob": 0.9899909496307373, "player": "b"}}, "131": {"suggestions": [{"move": "D6", "winrate": 0.5209117233753204, "policy_prob": 0.016952458769083023}, {"move": "M1", "winrate": 0.19011932611465454, "policy_prob": 0.4931504726409912, "is_actual_move": true}], "actual_move": {"move": "M1", "winrate": 0.19011950492858887, "policy_prob": 0.4931504726409912, "player": "w"}}, "132": {"suggestions": [{"move": "M2", "winrate": 0.8615096807479858, "policy_prob": 0.800021767616272}], "actual_move": {"move": "M2", "winrate": 0.8615096807479858, "policy_prob": 0.800021767616272, "player": "b"}}, "133": {"suggestions": [{"move": "D6", "winrate": 0.18306952714920044, "policy_prob": 0.020763566717505455}, {"move": "L1", "winrate": 0.17450177669525146, "policy_prob": 0.4404957890510559, "is_actual_move": true}], "actual_move": {"move": "L1", "winrate": 0.1745019555091858, "policy_prob": 0.4404957890510559, "player": "w"}}, "134": {"suggestions": [{"move": "K1", "winrate": 0.8909934684634209, "policy_prob": 0.8333014845848083}], "actual_move": {"move": "K1", "winrate": 0.8909934684634209, "policy_prob": 0.8333014845848083, "player": "b"}}, "135": {"suggestions": [{"move": "S6", "winrate": 0.23848497867584229, "policy_prob": 0.04762005805969238}, {"move": "N1", "winrate": 0.13742172718048096, "policy_prob": 0.8388239145278931, "is_actual_move": true}], "actual_move": {"move": "N1", "winrate": 0.13742172718048096, "policy_prob": 0.8388239145278931, "player": "w"}}, "136": {"suggestions": [{"move": "H10", "winrate": 0.8850184977054596, "policy_prob": 0.090059794485569}, {"move": "P1", "winrate": 0.820687472820282, "policy_prob": 0.7892234325408936, "is_actual_move": true}], "actual_move": {"move": "P1", "winrate": 0.820687472820282, "policy_prob": 0.7892234325408936, "player": "b"}}, "137": {"suggestions": [{"move": "D6", "winrate": 0.4039003252983093, "policy_prob": 0.07579950988292694}, {"move": "K2", "winrate": 0.24429166316986084, "policy_prob": 0.8965770602226257, "is_actual_move": true}], "actual_move": {"move": "K2", "winrate": 0.24429166316986084, "policy_prob": 0.8965770602226257, "player": "w"}}, "138": {"suggestions": [{"move": "H10", "winrate": 0.8683665990829468, "policy_prob": 0.14269490540027618}, {"move": "N4", "winrate": 0.8539187908172607, "policy_prob": 0.5695850849151611, "is_actual_move": true}], "actual_move": {"move": "N4", "winrate": 0.8539188802242279, "policy_prob": 0.5695850849151611, "player": "b"}}, "139": {"suggestions": [{"move": "D6", "winrate": 0.42019742727279663, "policy_prob": 0.07077041268348694}, {"move": "J1", "winrate": 0.2531728148460388, "policy_prob": 0.8805306553840637, "is_actual_move": true}], "actual_move": {"move": "J1", "winrate": 0.2531728148460388, "policy_prob": 0.8805306553840637, "player": "w"}}, "140": {"suggestions": [{"move": "H10", "winrate": 0.8957724422216415, "policy_prob": 0.36402449011802673}], "actual_move": {"move": "H10", "winrate": 0.8957727625966072, "policy_prob": 0.36402449011802673, "player": "b"}}, "141": {"suggestions": [{"move": "K9", "winrate": 0.2094448208808899, "policy_prob": 0.17276504635810852}, {"move": "H11", "winrate": 0.18614685535430908, "policy_prob": 0.3009025454521179, "is_actual_move": true}], "actual_move": {"move": "H11", "winrate": 0.1861467957496643, "policy_prob": 0.3009025454521179, "player": "w"}}, "142": {"suggestions": [{"move": "K9", "winrate": 0.8494070023298264, "policy_prob": 0.6325350403785706}], "actual_move": {"move": "K9", "winrate": 0.8494070023298264, "policy_prob": 0.6325350403785706, "player": "b"}}, "143": {"suggestions": [{"move": "K8", "winrate": 0.20604747533798218, "policy_prob": 0.4452703297138214}], "actual_move": {"move": "K8", "winrate": 0.2060478925704956, "policy_prob": 0.4452703297138214, "player": "w"}}, "144": {"suggestions": [{"move": "F9", "winrate": 0.8751417547464371, "policy_prob": 0.2240147590637207}, {"move": "J11", "winrate": 0.7864334732294083, "policy_prob": 0.33635181188583374, "is_actual_move": true}], "actual_move": {"move": "J11", "winrate": 0.7864334732294083, "policy_prob": 0.33635181188583374, "player": "b"}}, "145": {"suggestions": [{"move": "L9", "winrate": 0.27952539920806885, "policy_prob": 0.3126998543739319}], "actual_move": {"move": "L9", "winrate": 0.27952516078948975, "policy_prob": 0.3126998543739319, "player": "w"}}, "146": {"suggestions": [{"move": "F9", "winrate": 0.8111425787210464, "policy_prob": 0.22438666224479675}, {"move": "G11", "winrate": 0.66258305311203, "policy_prob": 0.4564949572086334, "is_actual_move": true}], "actual_move": {"move": "G11", "winrate": 0.66258305311203, "policy_prob": 0.4564949572086334, "player": "b"}}, "147": {"suggestions": [{"move": "H12", "winrate": 0.4583720564842224, "policy_prob": 0.9419004917144775}], "actual_move": {"move": "H12", "winrate": 0.4583720564842224, "policy_prob": 0.9419004917144775, "player": "w"}}, "148": {"suggestions": [{"move": "F9", "winrate": 0.6804257333278656, "policy_prob": 0.7970247864723206}], "actual_move": {"move": "F9", "winrate": 0.6804257333278656, "policy_prob": 0.7970247864723206, "player": "b"}}, "149": {"suggestions": [{"move": "F10", "winrate": 0.4581005573272705, "policy_prob": 0.9705673456192017}], "actual_move": {"move": "F10", "winrate": 0.4581005573272705, "policy_prob": 0.9705673456192017, "player": "w"}}, "150": {"suggestions": [{"move": "E9", "winrate": 0.5836381614208221, "policy_prob": 0.9178234338760376}], "actual_move": {"move": "E9", "winrate": 0.5836381614208221, "policy_prob": 0.9178234338760376, "player": "b"}}, "151": {"suggestions": [{"move": "J10", "winrate": 0.56708824634552, "policy_prob": 0.2845612168312073}, {"move": "F11", "winrate": 0.5326215624809265, "policy_prob": 0.6250441074371338, "is_actual_move": true}], "actual_move": {"move": "F11", "winrate": 0.5326215624809265, "policy_prob": 0.6250441074371338, "player": "w"}}, "152": {"suggestions": [{"move": "F12", "winrate": 0.5237585306167603, "policy_prob": 0.3772915303707123}], "actual_move": {"move": "F12", "winrate": 0.5237594842910767, "policy_prob": 0.3772915303707123, "player": "b"}}, "153": {"suggestions": [{"move": "E12", "winrate": 0.5280992686748505, "policy_prob": 0.2873484194278717}], "actual_move": {"move": "E12", "winrate": 0.5280999839305878, "policy_prob": 0.2873484194278717, "player": "w"}}, "154": {"suggestions": [{"move": "E11", "winrate": 0.741324782371521, "policy_prob": 0.3565181493759155}, {"move": "D11", "winrate": 0.3825819492340088, "policy_prob": 0.3626095950603485, "is_actual_move": true}], "actual_move": {"move": "D11", "winrate": 0.3825819492340088, "policy_prob": 0.3626095950603485, "player": "b"}}, "155": {"suggestions": [{"move": "L15", "winrate": 0.7555664628744125, "policy_prob": 0.4629112482070923}], "actual_move": {"move": "L15", "winrate": 0.7555670738220215, "policy_prob": 0.4629112482070923, "player": "w"}}, "156": {"suggestions": [{"move": "J10", "winrate": 0.158960223197937, "policy_prob": 0.17227131128311157}, {"move": "L8", "winrate": 0.14051437377929688, "policy_prob": 0.20532935857772827, "is_actual_move": true}], "actual_move": {"move": "L8", "winrate": 0.14051473140716553, "policy_prob": 0.20532935857772827, "player": "b"}}, "157": {"suggestions": [{"move": "J10", "winrate": 0.8360908329486847, "policy_prob": 0.16936981678009033}, {"move": "M8", "winrate": 0.7358842194080353, "policy_prob": 0.332582950592041, "is_actual_move": true}], "actual_move": {"move": "M8", "winrate": 0.7358846962451935, "policy_prob": 0.332582950592041, "player": "w"}}, "158": {"suggestions": [{"move": "J10", "winrate": 0.1896342635154724, "policy_prob": 0.20072078704833984}, {"move": "L7", "winrate": 0.16833996772766113, "policy_prob": 0.5370650887489319, "is_actual_move": true}], "actual_move": {"move": "L7", "winrate": 0.1683395504951477, "policy_prob": 0.5370650887489319, "player": "b"}}, "159": {"suggestions": [{"move": "J10", "winrate": 0.8420165330171585, "policy_prob": 0.4327002763748169}], "actual_move": {"move": "J10", "winrate": 0.8420165330171585, "policy_prob": 0.4327002763748169, "player": "w"}}, "160": {"suggestions": [{"move": "M9", "winrate": 0.24647653102874756, "policy_prob": 0.7018394470214844}], "actual_move": {"move": "M9", "winrate": 0.24647611379623413, "policy_prob": 0.7018394470214844, "player": "b"}}, "161": {"suggestions": [{"move": "M17", "winrate": 0.7827367335557938, "policy_prob": 0.14193210005760193}, {"move": "L10", "winrate": 0.7219330668449402, "policy_prob": 0.8208319544792175, "is_actual_move": true}], "actual_move": {"move": "L10", "winrate": 0.7219330668449402, "policy_prob": 0.8208319544792175, "player": "w"}}, "162": {"suggestions": [{"move": "N8", "winrate": 0.21708309650421143, "policy_prob": 0.8872789740562439}], "actual_move": {"move": "N8", "winrate": 0.21708309650421143, "policy_prob": 0.8872789740562439, "player": "b"}}, "163": {"suggestions": [{"move": "M17", "winrate": 0.791985347867012, "policy_prob": 0.27555036544799805}, {"move": "M10", "winrate": 0.7746146023273468, "policy_prob": 0.6535983681678772, "is_actual_move": true}], "actual_move": {"move": "M10", "winrate": 0.7746146023273468, "policy_prob": 0.6535983681678772, "player": "w"}}, "164": {"suggestions": [{"move": "N9", "winrate": 0.42411285638809204, "policy_prob": 0.244186133146286}, {"move": "R2", "winrate": 0.18553227186203003, "policy_prob": 0.3294517695903778, "is_actual_move": true}], "actual_move": {"move": "R2", "winrate": 0.18553227186203003, "policy_prob": 0.3294517695903778, "player": "b"}}, "165": {"suggestions": [{"move": "M17", "winrate": 0.8987918123602867, "policy_prob": 0.27604198455810547}, {"move": "N9", "winrate": 0.8661019504070282, "policy_prob": 0.5153259634971619, "is_actual_move": true}], "actual_move": {"move": "N9", "winrate": 0.8661015629768372, "policy_prob": 0.5153259634971619, "player": "w"}}, "166": {"suggestions": [{"move": "K16", "winrate": 0.20680522918701172, "policy_prob": 0.0757305771112442}, {"move": "C16", "winrate": 0.13298243284225464, "policy_prob": 0.23855923116207123, "is_actual_move": true}], "actual_move": {"move": "C16", "winrate": 0.13298261165618896, "policy_prob": 0.23855923116207123, "player": "b"}}, "167": {"suggestions": [{"move": "M17", "winrate": 0.9233282804489136, "policy_prob": 0.14898337423801422}, {"move": "B17", "winrate": 0.790446937084198, "policy_prob": 0.7223483920097351, "is_actual_move": true}], "actual_move": {"move": "B17", "winrate": 0.7904476374387741, "policy_prob": 0.7223483920097351, "player": "w"}}, "168": {"suggestions": [{"move": "E11", "winrate": 0.23353755474090576, "policy_prob": 0.09081129729747772}, {"move": "D15", "winrate": 0.1084548830986023, "policy_prob": 0.4806678593158722, "is_actual_move": true}], "actual_move": {"move": "D15", "winrate": 0.10845494270324707, "policy_prob": 0.4806678593158722, "player": "b"}}, "169": {"suggestions": [{"move": "C18", "winrate": 0.8682519644498825, "policy_prob": 0.6637441515922546}], "actual_move": {"move": "C18", "winrate": 0.8682519644498825, "policy_prob": 0.6637441515922546, "player": "w"}}, "170": {"suggestions": [{"move": "E11", "winrate": 0.2838857173919678, "policy_prob": 0.5217930674552917}], "actual_move": {"move": "E11", "winrate": 0.2838860750198364, "policy_prob": 0.5217930674552917, "player": "b"}}, "171": {"suggestions": [{"move": "G12", "winrate": 0.782988116145134, "policy_prob": 0.5156154036521912}], "actual_move": {"move": "G12", "winrate": 0.782988116145134, "policy_prob": 0.5156154036521912, "player": "w"}}, "172": {"suggestions": [{"move": "F13", "winrate": 0.22256654500961304, "policy_prob": 0.8104743957519531}], "actual_move": {"move": "F13", "winrate": 0.22256654500961304, "policy_prob": 0.8104743957519531, "player": "b"}}, "173": {"suggestions": [{"move": "M17", "winrate": 0.9085171222686768, "policy_prob": 0.31911003589630127}, {"move": "F14", "winrate": 0.7766819447278976, "policy_prob": 0.3568660318851471, "is_actual_move": true}], "actual_move": {"move": "F14", "winrate": 0.7766817063093185, "policy_prob": 0.3568660318851471, "player": "w"}}, "174": {"suggestions": [{"move": "F1", "winrate": 0.2579793930053711, "policy_prob": 0.023865221068263054}, {"move": "E13", "winrate": 0.22780531644821167, "policy_prob": 0.7851934432983398, "is_actual_move": true}], "actual_move": {"move": "E13", "winrate": 0.2278040647506714, "policy_prob": 0.7851934432983398, "player": "b"}}, "175": {"suggestions": [{"move": "M17", "winrate": 0.9053734764456749, "policy_prob": 0.1985236257314682}, {"move": "E5", "winrate": 0.7990705221891403, "policy_prob": 0.3505454659461975, "is_actual_move": true}], "actual_move": {"move": "E5", "winrate": 0.7990711033344269, "policy_prob": 0.3505454659461975, "player": "w"}}, "176": {"suggestions": [{"move": "D6", "winrate": 0.3060128092765808, "policy_prob": 0.9616929292678833}], "actual_move": {"move": "D6", "winrate": 0.3060128092765808, "policy_prob": 0.9616929292678833, "player": "b"}}, "177": {"suggestions": [{"move": "M17", "winrate": 0.8458055406808853, "policy_prob": 0.19721631705760956}, {"move": "T10", "winrate": 0.6518083214759827, "policy_prob": 0.3535827398300171, "is_actual_move": true}], "actual_move": {"move": "T10", "winrate": 0.6518077850341797, "policy_prob": 0.3535827398300171, "player": "w"}}, "178": {"suggestions": [{"move": "S6", "winrate": 0.3582283854484558, "policy_prob": 0.7968549132347107}], "actual_move": {"move": "S6", "winrate": 0.3582283854484558, "policy_prob": 0.7968549132347107, "player": "b"}}, "179": {"suggestions": [{"move": "M17", "winrate": 0.8148824274539948, "policy_prob": 0.22096244990825653}, {"move": "M7", "winrate": 0.6756883263587952, "policy_prob": 0.4187158942222595, "is_actual_move": true}], "actual_move": {"move": "M7", "winrate": 0.6756897866725922, "policy_prob": 0.4187158942222595, "player": "w"}}, "180": {"suggestions": [{"move": "K16", "winrate": 0.7420395910739899, "policy_prob": 0.32592636346817017}, {"move": "G13", "winrate": 0.3054233193397522, "policy_prob": 0.4079478085041046, "is_actual_move": true}], "actual_move": {"move": "G13", "winrate": 0.3054211139678955, "policy_prob": 0.4079478085041046, "player": "b"}}, "181": {"suggestions": [{"move": "M17", "winrate": 0.8816107586026192, "policy_prob": 0.30555880069732666}], "actual_move": {"move": "M17", "winrate": 0.8816111981868744, "policy_prob": 0.30555880069732666, "player": "w"}}, "182": {"suggestions": [{"move": "K17", "winrate": 0.25522106885910034, "policy_prob": 0.7737526297569275}], "actual_move": {"move": "K17", "winrate": 0.25522077083587646, "policy_prob": 0.7737526297569275, "player": "b"}}, "183": {"suggestions": [{"move": "T18", "winrate": 0.8020760416984558, "policy_prob": 0.15265515446662903}, {"move": "G18", "winrate": 0.7204523086547852, "policy_prob": 0.41787195205688477, "is_actual_move": true}], "actual_move": {"move": "G18", "winrate": 0.7204532623291016, "policy_prob": 0.41787195205688477, "player": "w"}}, "184": {"suggestions": [{"move": "G17", "winrate": 0.3115506172180176, "policy_prob": 0.8879256248474121}], "actual_move": {"move": "G17", "winrate": 0.3115506172180176, "policy_prob": 0.8879256248474121, "player": "b"}}, "185": {"suggestions": [{"move": "F17", "winrate": 0.8106503188610077, "policy_prob": 0.7109401822090149}], "actual_move": {"move": "F17", "winrate": 0.810649648308754, "policy_prob": 0.7109401822090149, "player": "w"}}, "186": {"suggestions": [{"move": "H18", "winrate": 0.16462969779968262, "policy_prob": 0.44249477982521057}], "actual_move": {"move": "H18", "winrate": 0.16463005542755127, "policy_prob": 0.44249477982521057, "player": "b"}}, "187": {"suggestions": [{"move": "E18", "winrate": 0.9480737969279289, "policy_prob": 0.8082650303840637}], "actual_move": {"move": "E18", "winrate": 0.9480735473334789, "policy_prob": 0.8082650303840637, "player": "w"}}, "188": {"suggestions": [{"move": "G19", "winrate": 0.061332881450653076, "policy_prob": 0.2967984080314636}, {"move": "J13", "winrate": 0.06440204381942749, "policy_prob": 0.2146848887205124}, {"move": "J14", "winrate": 0.061031222343444824, "policy_prob": 0.06781763583421707}], "actual_move": {"move": "G19", "winrate": 0.061332762241363525, "policy_prob": 0.2967984080314636, "player": "b"}}, "189": {"suggestions": [{"move": "T18", "winrate": 0.9713802114129066, "policy_prob": 0.49863848090171814}], "actual_move": {"move": "T18", "winrate": 0.9713802244514227, "policy_prob": 0.49863848090171814, "player": "w"}}, "190": {"suggestions": [{"move": "J13", "winrate": 0.032789409160614014, "policy_prob": 0.10598110407590866}, {"move": "J14", "winrate": 0.03226083517074585, "policy_prob": 0.10161609947681427}, {"move": "A5", "winrate": 0.032013118267059326, "policy_prob": 0.0651831403374672}, {"move": "N7", "winrate": 0.02139383554458618, "policy_prob": 0.29648593068122864, "is_actual_move": true}], "actual_move": {"move": "N7", "winrate": 0.021393954753875732, "policy_prob": 0.29648593068122864, "player": "b"}}, "191": {"suggestions": [{"move": "M6", "winrate": 0.9905131533741951, "policy_prob": 0.8069076538085938}], "actual_move": {"move": "M6", "winrate": 0.9905131533741951, "policy_prob": 0.8069076538085938, "player": "w"}}, "192": {"suggestions": [{"move": "K3", "winrate": 0.05846607685089111, "policy_prob": 0.06031729280948639}]}};
let player = new WGo.SimplePlayer(document.getElementById('board'), { sgf: SGF });
let currentMove = 0;
let labels = {};  // move index -> tag mapping
let activeSpatialTags = new Set();  // Set of currently selected spatial tags

// Try to sync with WGo.js player state changes
function syncPlayerState() {
  // Calculate current move from player state
  let moveCount = 0;
  if(player.currentNode && player.rootNode) {
    let node = player.rootNode;
    while(node !== player.currentNode && node.children && node.children.length > 0) {
      moveCount++;
      node = node.children[0];
    }
  }
  
  // Only update if move actually changed
  if(moveCount !== currentMove) {
    console.log('Move changed from', currentMove, 'to', moveCount);
    currentMove = moveCount;
    
    // Update our custom UI
    updateMoveDisplay();
    renderForm();
    renderPolicy();
    
    // Delay marker rendering to let WGo.js finish updating
    setTimeout(() => {
      renderMarkers();
    }, 10);
  }
}

// Check for player state changes periodically
setInterval(syncPlayerState, 100);

// Also try to hook into WGo.js events if available
if(player.on && typeof player.on === 'function') {
  console.log('Using player.on for events');
  player.on('update', syncPlayerState);
  player.on('change', syncPlayerState);
} else if(player.addEventListener && typeof player.addEventListener === 'function') {
  console.log('Using player.addEventListener for events');
  player.addEventListener('update', syncPlayerState);
  player.addEventListener('change', syncPlayerState);
} else {
  console.log('Using polling method for player state sync');
}

// Extract game info from SGF
function initGameInfo() {
  try {
    let sgfRoot = null;
    
    // Try different ways to access SGF info - WGo SimplePlayer structure
    if(player.rootNode && player.rootNode.properties) {
      sgfRoot = player.rootNode.properties;
    } else if(player.game && player.game.root && player.game.root.properties) {
      sgfRoot = player.game.root.properties;
    } else if(player.rootNode) {
      sgfRoot = player.rootNode;
    } else {
      console.log('Could not find SGF root info, using defaults');
    }
    
    console.log('SGF Root found:', sgfRoot);
    
    // Extract player names - try multiple formats
    let blackPlayer = 'Black';
    let whitePlayer = 'White';
    let gameDate = '';
    let result = '';
    
    if(sgfRoot) {
      // Try array format first [SGF standard]
      if(sgfRoot.PB && Array.isArray(sgfRoot.PB)) blackPlayer = sgfRoot.PB[0];
      else if(sgfRoot.PB) blackPlayer = sgfRoot.PB;
      
      if(sgfRoot.PW && Array.isArray(sgfRoot.PW)) whitePlayer = sgfRoot.PW[0];
      else if(sgfRoot.PW) whitePlayer = sgfRoot.PW;
      
      if(sgfRoot.DT && Array.isArray(sgfRoot.DT)) gameDate = sgfRoot.DT[0];
      else if(sgfRoot.DT) gameDate = sgfRoot.DT;
      
      if(sgfRoot.RE && Array.isArray(sgfRoot.RE)) result = sgfRoot.RE[0];
      else if(sgfRoot.RE) result = sgfRoot.RE;
    }
    
    // Fallback: extract from raw SGF string if properties didn't work
    if(blackPlayer === 'Black' || whitePlayer === 'White') {
      const pbMatch = SGF.match(/PB\[([^\]]*)\]/);
      const pwMatch = SGF.match(/PW\[([^\]]*)\]/);
      if(pbMatch && pbMatch[1]) blackPlayer = pbMatch[1];
      if(pwMatch && pwMatch[1]) whitePlayer = pwMatch[1];
    }
    
    console.log('Final extracted names:', blackPlayer, whitePlayer);
    
    document.getElementById('black-player').textContent = blackPlayer || 'Black';
    document.getElementById('white-player').textContent = whitePlayer || 'White';
    document.getElementById('game-info').textContent = gameDate + (result ? ' • ' + result : '');
  } catch(e) {
    console.error('Error initializing game info:', e);
    document.getElementById('black-player').textContent = 'Black';
    document.getElementById('white-player').textContent = 'White';
    document.getElementById('game-info').textContent = 'Game loaded';
  }
}

function renderForm() {
  const globalColumn = document.getElementById('global_column');
  const spatialColumn = document.getElementById('spatial_column');
  
  // Clear both columns
  globalColumn.innerHTML = '';
  spatialColumn.innerHTML = '';
  
  // Clear and restore active spatial tags for current move
  activeSpatialTags.clear();
  
  // Render global groups (global, initiative, location, shape)
  Object.entries(GLOBAL_GROUPS).forEach(([groupName, tags]) => {
    if (tags.length === 0) return;
    
    const groupDiv = document.createElement('div');
    groupDiv.className = 'label-group';
    groupDiv.innerHTML = `<h4>${groupName}</h4><div class="tag-grid"></div>`;
    
    const tagGrid = groupDiv.querySelector('.tag-grid');
    tags.forEach(tag => {
      const checked = labels[currentMove] && labels[currentMove][tag] ? 'checked' : '';
      const tagBlock = document.createElement('div');
      tagBlock.className = 'tag-block';
      tagBlock.innerHTML = `<label><input type="checkbox" data-tag="${tag}" ${checked}/> ${tag}</label>`;
      tagGrid.appendChild(tagBlock);
    });
    
    globalColumn.appendChild(groupDiv);
  });
  
  // Add location and shape to the left column
  ['location', 'shape'].forEach(groupName => {
    const tags = SPATIAL_GROUPS[groupName] || [];
    if (tags.length === 0) return;
    
    const groupDiv = document.createElement('div');
    groupDiv.className = 'label-group';
    groupDiv.innerHTML = `<h4>${groupName}</h4><div class="tag-grid"></div>`;
    
    const tagGrid = groupDiv.querySelector('.tag-grid');
    tags.forEach(tag => {
      const pts = (labels[currentMove] && labels[currentMove][tag]) || [];
      const isChecked = labels[currentMove] && labels[currentMove][tag + '_checked'] === true;
      const checked = isChecked ? 'checked' : '';
      
      // Restore active spatial tags for checked spatial tags
      if (isChecked) {
        activeSpatialTags.add(tag);
      }
      
      const tagBlock = document.createElement('div');
      tagBlock.className = 'tag-block';
      tagBlock.innerHTML = `<label><input type="checkbox" data-tag="${tag}" ${checked}/> ${tag}</label> <span class="tag-points" id="${tag}_pts">${pts.map(p => '(' + p[0] + ',' + p[1] + ')').join(' ')}</span>`;
      tagGrid.appendChild(tagBlock);
    });
    
    globalColumn.appendChild(groupDiv);
  });
  
  // Render strategic and tactical groups only
  ['strategic', 'tactical'].forEach(groupName => {
    const tags = SPATIAL_GROUPS[groupName] || [];
    if (tags.length === 0) return;
    
    const groupDiv = document.createElement('div');
    groupDiv.className = 'label-group';
    groupDiv.innerHTML = `<h4>${groupName}</h4><div class="tag-grid"></div>`;
    
    const tagGrid = groupDiv.querySelector('.tag-grid');
    tags.forEach(tag => {
      const pts = (labels[currentMove] && labels[currentMove][tag]) || [];
      const isChecked = labels[currentMove] && labels[currentMove][tag + '_checked'] === true;
      const checked = isChecked ? 'checked' : '';
      
      // Restore active spatial tags for checked spatial tags
      if (isChecked) {
        activeSpatialTags.add(tag);
      }
      
      const tagBlock = document.createElement('div');
      tagBlock.className = 'tag-block';
      tagBlock.innerHTML = `<label><input type="checkbox" data-tag="${tag}" ${checked}/> ${tag}</label> <span class="tag-points" id="${tag}_pts">${pts.map(p => '(' + p[0] + ',' + p[1] + ')').join(' ')}</span>`;
      tagGrid.appendChild(tagBlock);
    });
    
    spatialColumn.appendChild(groupDiv);
  });
}

function renderMarkers() {
  // Access board through SimplePlayer structure - try multiple ways
  let board = null;
  
  console.log('=== RENDER MARKERS DEBUG ===');
  
  // Try different ways to access the board
  if(player.components && player.components.get) {
    // components is a Map, get the board container
    const boardElement = document.getElementById('board');
    const container = player.components.get(boardElement);
    console.log('Board from components Map:', container);
    
    // Based on the structure we can see, try to get SVGBoardComponent directly
    if(container && container.children && container.children[1] && container.children[1].children) {
      const svgBoardComponent = container.children[1].children[0];
      console.log('Direct access to SVGBoardComponent:', svgBoardComponent);
      if(svgBoardComponent && svgBoardComponent.board) {
        console.log('Direct access to SVGBoard:', svgBoardComponent.board);
        board = svgBoardComponent.board;
      }
    }
    
    if(!board) {
      board = container;
    }
  }
  
  if(!board && player.board) {
    board = player.board;
    console.log('Board from player.board:', board);
  }
  
  if(!board && player.components && player.components.board) {
    board = player.components.board;
    console.log('Board from player.components.board:', board);
  }
  
  console.log('Final board object:', board);
  console.log('Board methods available:', board ? Object.getOwnPropertyNames(board) : 'No board');
  
  // If we found a Container, search through its children for the board component
  if(board && board.children && Array.isArray(board.children)) {
    console.log('Container children:', board.children);
    
    // Look for a child that has board methods
    for(let child of board.children) {
      console.log('Checking child:', child);
      console.log('Child methods:', child ? Object.getOwnPropertyNames(child) : 'No child');
      
      if(child && child.removeAllObjects) {
        console.log('Found board in child:', child);
        board = child;
        break;
      }
      
      // Also check if child has a board property
      if(child && child.board && child.board.removeAllObjects) {
        console.log('Found board in child.board:', child.board);
        board = child.board;
        break;
      }
      
      // Check if this is a ResponsiveComponent with a component property
      if(child && child.component) {
        console.log('Checking child.component:', child.component);
        if(child.component.removeAllObjects) {
          console.log('Found board in child.component:', child.component);
          board = child.component;
          break;
        }
        
        // If component is a Container, check its children too
        if(child.component.children && Array.isArray(child.component.children)) {
          console.log('Checking nested container children:', child.component.children);
          for(let nestedChild of child.component.children) {
            console.log('Nested child:', nestedChild);
            console.log('Nested child type:', nestedChild.constructor.name);
            
            if(nestedChild && nestedChild.removeAllObjects) {
              console.log('Found board in nested child:', nestedChild);
              board = nestedChild;
              break;
            }
            
            // Check for SVGBoardComponent which has a board property
            if(nestedChild && nestedChild.constructor && nestedChild.constructor.name === 'SVGBoardComponent') {
              console.log('Found SVGBoardComponent, checking its board property:', nestedChild.board);
              if(nestedChild.board) {
                console.log('SVGBoard object:', nestedChild.board);
                console.log('SVGBoard methods:', Object.getOwnPropertyNames(nestedChild.board));
                board = nestedChild.board;
                break;
              }
            }
            
            // Also check nested child's board property
            if(nestedChild && nestedChild.board && nestedChild.board.removeAllObjects) {
              console.log('Found board in nested child.board:', nestedChild.board);
              board = nestedChild.board;
              break;
            }
          }
          if(board && board.removeAllObjects) break; // Exit outer loop if found
        }
      }
    }
  }
  
  // If we found a Container, try to access its board
  if(board && !board.removeAllObjects && board.board) {
    console.log('Trying board.board:', board.board);
    board = board.board;
  }
  
  // Also try accessing through getBoard method if it exists
  if(board && !board.removeAllObjects && board.getBoard) {
    console.log('Trying board.getBoard():', board.getBoard());
    board = board.getBoard();
  }
  
  // If we still haven't found the board, do a recursive search
  if(!board || !board.removeAllObjects) {
    console.log('Board not found yet, doing recursive search...');
    
    function findBoardRecursively(obj, path = '') {
      if(!obj) return null;
      
      // Check if this object is the board we want
      if(obj.removeAllObjects && obj.addObject) {
        console.log('Found board at path:', path, obj);
        return obj;
      }
      
      // Check if this is SVGBoardComponent
      if(obj.constructor && obj.constructor.name === 'SVGBoardComponent') {
        console.log('Found SVGBoardComponent at path:', path, obj);
        if(obj.board && obj.board.removeAllObjects) {
          console.log('Found board in SVGBoardComponent.board:', obj.board);
          return obj.board;
        }
      }
      
      // Recursively search common properties
      const propsToSearch = ['board', 'component', 'children', 'components'];
      for(let prop of propsToSearch) {
        if(obj[prop]) {
          if(Array.isArray(obj[prop])) {
            for(let i = 0; i < obj[prop].length; i++) {
              const result = findBoardRecursively(obj[prop][i], path + '.' + prop + '[' + i + ']');
              if(result) return result;
            }
          } else {
            const result = findBoardRecursively(obj[prop], path + '.' + prop);
            if(result) return result;
          }
        }
      }
      
      return null;
    }
    
    const foundBoard = findBoardRecursively(player, 'player');
    if(foundBoard) {
      board = foundBoard;
      console.log('Recursively found board:', board);
    }
  }
  
  console.log('Final resolved board:', board);
  if(board) {
    console.log('Board methods:', Object.getOwnPropertyNames(board));
    console.log('Board config:', board.config);
    console.log('Board size/dimensions:', { width: board.width, height: board.height, size: board.size });
    console.log('Existing board objects:', board.objects);
    
    // Check if there are existing objects and their coordinate format
    if(board.objects && board.objects.length > 0) {
      console.log('Sample existing object:', board.objects[0]);
      console.log('Existing object coordinates:', { x: board.objects[0].x, y: board.objects[0].y });
    }
  }
  
  if(board && board.objects) {
    // Remove only our custom objects (AI labels and user tags), keep game stones
    const objectsToRemove = board.objects.filter(obj => 
      obj.type === 'LB' || obj.type === 'MA' || obj.type === 'CR' || obj.type === 'SQ'
    );
    objectsToRemove.forEach(obj => board.removeObject(obj));
    
    console.log('Removed', objectsToRemove.length, 'custom objects, keeping game stones');
    
    // Render user tags
    const tags = labels[currentMove] || {};
    Object.keys(tags).forEach(tag => {
      const pts = tags[tag];
      if(Array.isArray(pts)) {
        pts.forEach(pt => board.addObject({ x: pt[0], y: pt[1], type: 'MA' }));
      }
    });
    
         // Render policy suggestions for the position that was just played (not the upcoming move)
     // Show suggestions for the previous move (what AI suggested before this move was played)
     const positionKey = currentMove > 0 ? (currentMove - 1).toString() : null;
     const positionData = positionKey ? POLICY[positionKey] : null;
     const policyMoves = positionData && positionData.suggestions ? positionData.suggestions : [];
     console.log('Rendering', policyMoves.length, 'policy moves for position', positionKey, 'Position data:', positionData);
    
    if(policyMoves.length > 0) {
      const playerToMove = currentMove % 2 === 0 ? 'black' : 'white';
      console.log('Player to move:', playerToMove);
      
      policyMoves.forEach((move, index) => {
        const coord = sgfToCoord(move.move);
        
        if(coord && typeof coord.x === 'number' && typeof coord.y === 'number' && 
           coord.x >= 0 && coord.x < 19 && coord.y >= 0 && coord.y < 19) {
          try {
            
            // Add policy move marker with red styling
            const winrateText = (move.winrate * 100).toFixed(0);
            console.log('Adding policy label at:', coord.x, coord.y, 'with text:', winrateText);
            
            // Create label object with unique identifier
            const uniqueId = 'policy-' + coord.x + '-' + coord.y + '-' + index;
            const labelObj = new WGo.LabelBoardObject(winrateText, coord.x, coord.y);
            
            // Mark this as a policy label so we can style it differently
            labelObj.isPolicyLabel = true;
            labelObj.policyId = uniqueId;
            
            board.addObject(labelObj);
            
                        // Apply red styling after the object is added to the DOM
            setTimeout(() => {
              const boardElement = document.getElementById('board');
              const textElements = boardElement.querySelectorAll('text');
              
              let matchingElements = [];
              
              textElements.forEach((textEl, index) => {
                // Only style text elements that contain our winrate numbers AND are not board coordinates
                // Board coordinates are typically single/double digit numbers or letters, winrates are percentages
                if(textEl.textContent === winrateText) {
                  // Additional check: make sure this isn't a coordinate label
                  // Coordinates are usually positioned at board edges, policy labels are on intersections
                  const rect = textEl.getBoundingClientRect();
                  const boardRect = boardElement.getBoundingClientRect();
                  
                  // Check if the text is within the main board area (not on edges where coordinates would be)
                  const isInMainBoardArea = rect.left > boardRect.left + 20 && 
                                          rect.right < boardRect.right - 20 &&
                                          rect.top > boardRect.top + 10 && 
                                          rect.bottom < boardRect.bottom - 10;
                  
                  if(isInMainBoardArea) {
                    matchingElements.push(textEl);
                  }
                }
              });
              
              // Style only the elements that are actually policy labels
              matchingElements.forEach((elem) => {
                // Apply red styling with smaller font size
                elem.style.setProperty('fill', 'red', 'important');
                elem.style.setProperty('color', 'red', 'important');
                elem.style.setProperty('font-weight', 'bold', 'important');
                elem.style.setProperty('font-size', '0.8px', 'important');
                elem.setAttribute('fill', 'red');
                elem.classList.add('policy-label');
              });
            }, 100);
            
            console.log('Successfully added red label at', coord.x, coord.y);
            

            
            console.log('Added policy move at', coord.x, coord.y, 'with winrate', winrateText + '%');
          } catch(e) {
            console.error('Error adding board object:', e);
            console.error('Board object at error:', board);
            console.error('Board addObject method:', typeof board.addObject);
          }
        } else {
          console.error('Invalid coordinates for move:', move.move, coord);
        }
      });
    } else {
      console.log('No policy moves to render for position', currentMove);
    }
    
    // Refresh only the objects layer, not the entire board
    if(board && board.redraw) {
      console.log('Calling board.redraw() to refresh custom objects');
      board.redraw();
    }
    
    console.log('Total objects on board after rendering:', board.objects.length);
    console.log('Objects:', board.objects.map(obj => obj.type || 'unknown'));
  } else {
    console.error('Board object not found or missing removeAllObjects method');
    console.error('Player structure:', player);
  }
}

function sgfToCoord(moveString) {
  if(!moveString || moveString === 'pass') {
    console.log('Skipping move:', moveString);
    return null;
  }
  
  console.log('Converting move string:', moveString);
  
  // Handle SGF coordinates like 'pd', 'dp', etc. (lowercase letters)
  if(moveString.length === 2 && /^[a-s][a-s]$/.test(moveString)) {
    const x = moveString.charCodeAt(0) - 'a'.charCodeAt(0);
    const y = moveString.charCodeAt(1) - 'a'.charCodeAt(0);
    console.log(`SGF format ${moveString}: x=${x}, y=${y}`);
    return { x: x, y: y };
  }
  
  // Handle human coordinates like 'C16', 'D4', 'P16', etc.
  const match = moveString.match(/^([A-HJ-T])(\d+)$/);
  if(match) {
    const letter = match[1];
    const number = parseInt(match[2], 10);
    
    // Convert letter to x coordinate (A=0, B=1, ..., H=7, J=8, ..., T=18)
    let x = letter.charCodeAt(0) - 'A'.charCodeAt(0);
    if(x >= 8) x--; // Skip 'I' in Go notation
    
    // Convert number to y coordinate (1=18, 2=17, ..., 19=0)
    const y = 19 - number;
    
    console.log(`Human format ${moveString}: letter=${letter}, number=${number}, x=${x}, y=${y}`);
    
    // Validate the coordinates
    if(isNaN(x) || isNaN(y) || x < 0 || x >= 19 || y < 0 || y >= 19) {
      console.error(`Invalid coordinates generated: x=${x}, y=${y} from ${moveString}`);
      return null;
    }
    
    return { x: x, y: y };
  }
  
  console.error('Failed to parse move:', moveString);
  return null;
}

  function renderPolicy() {
    const div = document.getElementById('policy_suggestions');
    // Show policy suggestions for the position that was just played (not the upcoming move)
    const positionKey = currentMove > 0 ? (currentMove - 1).toString() : null;
    const positionData = positionKey ? POLICY[positionKey] : null;
    const opts = positionData && positionData.suggestions ? positionData.suggestions : [];
    
    console.log('Current move:', currentMove, 'Policy data for position:', positionKey, 'Position data:', positionData, 'Suggestions:', opts);
  
     if(currentMove === 0) {
     div.innerHTML = '<em>No move played yet</em>';
     return;
   }
   
   if(!positionData || !opts || opts.length === 0) {
     div.innerHTML = '<em>No AI suggestions available for this position</em>';
     return;
   }
   
       // The player who was to move at the previous position (before current move was played)
    const playerWhoMoved = (currentMove - 1) % 2 === 0 ? 'Black' : 'White';
    const lines = opts.map(o => {
      const winrateText = `${(o.winrate * 100).toFixed(1)}%`;
      const policyText = o.policy_prob ? `${(o.policy_prob * 100).toFixed(1)}%` : 'N/A';
      const actualMoveMarker = o.is_actual_move ? ' ★' : '';
      return `<div class="policy-move">${o.move}: ${winrateText} win, ${policyText} prob${actualMoveMarker}</div>`;
    });
    // Display move number as 1-indexed (currentMove is already the human-readable move number)
    div.innerHTML = `<strong>AI suggestions for ${playerWhoMoved} at move ${currentMove}</strong><br/>${lines.join('')}`;
}

// Set up event delegation for both columns
document.getElementById('global_column').addEventListener('change', e => {
  const tag = e.target.getAttribute('data-tag');
  if(tag) {
    labels[currentMove] = labels[currentMove] || {};
    
    // Check if this is a spatial tag (location or shape) or a regular global tag
    const isSpatialTag = Object.values(SPATIAL_GROUPS).some(groupTags => groupTags.includes(tag));
    
    if(isSpatialTag) {
      if(e.target.checked) {
        // Add to active spatial tags for board clicking
        activeSpatialTags.add(tag);
        // Initialize as empty array if not exists
        if(!labels[currentMove][tag]) {
          labels[currentMove][tag] = [];
        }
        // Mark this tag as checked
        labels[currentMove][tag + '_checked'] = true;
      } else {
        // Remove from active spatial tags
        activeSpatialTags.delete(tag);
        // Mark this tag as unchecked
        labels[currentMove][tag + '_checked'] = false;
      }
    } else {
      // Regular global tag (boolean)
      labels[currentMove][tag] = e.target.checked;
    }
  }
});

document.getElementById('spatial_column').addEventListener('change', e => {
  const tag = e.target.getAttribute('data-tag');
  if(tag) {
    labels[currentMove] = labels[currentMove] || {};
    if(e.target.checked) {
      // Add to active spatial tags for board clicking
      activeSpatialTags.add(tag);
      // Initialize as empty array if not exists
      if(!labels[currentMove][tag]) {
        labels[currentMove][tag] = [];
      }
      // Mark this tag as checked
      labels[currentMove][tag + '_checked'] = true;
    } else {
      // Remove from active spatial tags
      activeSpatialTags.delete(tag);
      // Mark this tag as unchecked
      labels[currentMove][tag + '_checked'] = false;
    }
  }
});

// Set up click handler for the board
const board = player.board || (player.components && player.components.board);
if(board && board.addEventListener) {
  board.addEventListener('click', (x, y) => {
    if(activeSpatialTags.size === 0) return;
    labels[currentMove] = labels[currentMove] || {};
    
    // Add the clicked point to all active spatial tags
    activeSpatialTags.forEach(tag => {
      labels[currentMove][tag] = labels[currentMove][tag] || [];
      labels[currentMove][tag].push([x, y]);
    });
    
    renderForm();
    renderMarkers();
  });
}

function updateMoveDisplay() {
  document.getElementById('move_idx').textContent = currentMove;
}

function gotoMove(idx) {
  try {
    console.log('Manual navigation to move', idx, 'from current move', currentMove);
    
    if(idx < 0) {
      console.log('Move index too low');
      return;
    }
    
    // Use WGo.js navigation methods that properly maintain board state
    if(idx > currentMove) {
      // Move forward one step at a time
      for(let i = currentMove; i < idx; i++) {
        if(player.next && typeof player.next === 'function') {
          player.next();
        } else {
          break;
        }
      }
    } else if(idx < currentMove) {
      // Move backward one step at a time
      for(let i = currentMove; i > idx; i--) {
        if(player.previous && typeof player.previous === 'function') {
          player.previous();
        } else {
          break;
        }
      }
    }
    
    // The 'update' event listener will handle UI updates
    console.log('Navigation completed');
  } catch(e) {
    console.error('Error in gotoMove:', e);
  }
}

document.getElementById('next').onclick = () => gotoMove(currentMove + 1);
document.getElementById('prev').onclick = () => gotoMove(currentMove - 1);

document.getElementById('export').onclick = () => {
  const data = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(labels));
  const a = document.createElement('a');
  a.setAttribute('href', data);
  a.setAttribute('download', 'labels.json');
  a.click();
};

console.log('Player object:', player);
console.log('Player kifu:', player.kifu);
console.log('Player available methods:', Object.getOwnPropertyNames(player));
if(player.kifu) {
  console.log('Kifu structure:', Object.getOwnPropertyNames(player.kifu));
}
initGameInfo();
renderForm();
updateMoveDisplay();
renderPolicy();
renderMarkers();
</script>
</body>
</html>
